"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){angular.module("StockFlux",["ngAnimate","stockflux.main","stockflux.showcase","stockflux.toolbar","stockflux.icon","stockflux.search","stockflux.favourites","stockflux.sidebar","stockflux.filters","stockflux.star","stockflux.tearout","stockflux.minichart","stockflux.scroll","stockflux.closedWindows","stockflux.closedCard","stockflux.config","stockflux.version"]),angular.module("stockflux.main",[]),angular.module("stockflux.showcase",["stockflux.selection","stockflux.quandl","stockflux.config"]),angular.module("stockflux.toolbar",["stockflux.currentWindow","stockflux.closedWindows"]),angular.module("stockflux.icon",[]),angular.module("stockflux.search",["stockflux.quandl","stockflux.selection","stockflux.currentWindow"]),angular.module("stockflux.favourites",["stockflux.quandl","stockflux.selection","stockflux.currentWindow"]),angular.module("stockflux.sidebar",[]),angular.module("stockflux.filters",[]),angular.module("stockflux.star",["stockflux.selection"]),angular.module("stockflux.tearout",["stockflux.geometry","stockflux.hover","stockflux.currentWindow","stockflux.config"]),angular.module("stockflux.minichart",["stockflux.quandl"]),angular.module("stockflux.store",[]),angular.module("stockflux.currentWindow",[]),angular.module("stockflux.scroll",[]),angular.module("stockflux.closedWindows",["stockflux.closedCard"]),angular.module("stockflux.closedCard",[]),angular.module("stockflux.config",[]),angular.module("stockflux.version",["stockflux.currentWindow"])}(),function(){var a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"openClosedWindow",value:function(a){var b=window.storeService.open(a);window.windowService.createMainWindow(a,b.isCompact())}}]),a}();a.$inject=[],angular.module("stockflux.closedCard").controller("ClosedCardCtrl",a)}(),function(){angular.module("stockflux.closedCard").directive("closedCard",[function(){return{restrict:"E",templateUrl:"closedWindows/closedCard/closedCard.html",scope:{cardWindow:"="},controller:"ClosedCardCtrl",controllerAs:"closedCardCtrl"}}])}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.$scope=b,this.$timeout=c,this.closedWindows=[],this.closedTabsShow=!1,this.overriddenIcon="",this._watch()}return _createClass(a,[{key:"override",value:function(){return this.overriddenIcon}},{key:"refreshClosedWindows",value:function(){this.closedWindows=window.storeService.getPreviousClosedWindows(),this.updateSeen()}},{key:"updateSeen",value:function(){var a=window.windowService.getClosedWindowSeen();this.overriddenIcon=a?"":this.$scope.icon+"_active",!a&&this.closedTabsShow&&document.hasFocus()&&window.windowService.seenClosedWindows()}},{key:"click",value:function(){this.overriddenIcon="",this.refreshClosedWindows(),this.closedTabsShow=this.closedWindows.length>0,window.windowService&&window.windowService.seenClosedWindows()}},{key:"_watch",value:function(){var a=this,b=function(){return a.$timeout(function(){return a.refreshClosedWindows()})},c=function(){window.windowService&&(window.windowService.addClosedWindowListener(b),a.refreshClosedWindows())};window.windowService?c():this.$scope.$watch(function(){return window.windowService},function(){c()}),this.$scope.$on("$destroy",function(){window.windowService.removeClosedWindowListener(b)})}}]),a}();a.$inject=["$scope","$timeout"],angular.module("stockflux.closedWindows").controller("ClosedWindowListCtrl",a)}(),function(){angular.module("stockflux.closedWindows").directive("closedWindowList",[function(){return{restrict:"E",templateUrl:"closedWindows/closedWindowList/closedWindowList.html",controller:"ClosedWindowListCtrl",controllerAs:"closedWindowListCtrl",scope:{icon:"="},link:function(a,b){var c=function(){a.closedWindowListCtrl.closedTabsShow&&window.windowService.seenClosedWindows()};window.addEventListener("focus",c),a.$on("$destroy",function(){window.removeEventListener("focus",c)})}}}])}(),function(){var a=5e4,b=1200,c=112/b,d=[268,65],e=[218,47],f=!1,g=function(){function g(){_classCallCheck(this,g)}return _createClass(g,[{key:"createName",value:function(){return"window"+Math.floor(1e3*Math.random())+Math.ceil(999*Math.random())}},{key:"getWindowConfig",value:function(b){return{name:b||this.createName(),contextMenu:f,autoShow:!1,frame:!1,showTaskbarIcon:!0,saveWindowState:!0,url:"index.html",resizable:!0,maximizable:!0,minWidth:918,minHeight:510,maxWidth:a,maxHeight:a,defaultWidth:1280,defaultHeight:720,shadow:!0,resizeRegion:{size:7,topLeftCorner:14,topRightCorner:14,bottomRightCorner:14,bottomLeftCorner:14}}}},{key:"getCompactConfig",value:function(a){return{name:a||this.createName(),contextMenu:f,autoShow:!1,frame:!1,showTaskbarIcon:!0,saveWindowState:!0,url:"index.html",resizable:!1,maximizable:!1,minWidth:230,minHeight:500,maxWidth:230,maxHeight:500,defaultWidth:230,defaultHeight:500,shadow:!0}}},{key:"getTearoutConfig",value:function(a){return{name:a||this.createName(),contextMenu:f,autoShow:!1,frame:!1,maximizable:!1,resizable:!1,showTaskbarIcon:!1,saveWindowState:!1,maxWidth:230,maxHeight:100,url:"tearout.html",shadow:!0}}},{key:"getTopCardOffset",value:function(a){return a?e:d}},{key:"getInitialBitfluxProportion",value:function(){return c}},{key:"getBitfluxStockAmount",value:function(){return b}}]),g}();g.$inject=[],angular.module("stockflux.config").service("configService",g)}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.$scope=b,this.active=!1,this.urls={inactive:b.name,active:b.name+"_active"}}return _createClass(a,[{key:"enter",value:function(){this.active=!0}},{key:"leave",value:function(){this.active=!1}},{key:"url",value:function(){var a=this.$scope.override;return a?a:this.active?this.urls.active:this.urls.inactive}},{key:"click",value:function(a){0===a.button&&(this.$scope.iconClick(),this.active=!1,a.stopPropagation())}}]),a}();a.$inject=["$scope"],angular.module("stockflux.icon").controller("IconCtrl",a)}(),function(){angular.module("stockflux.icon").directive("icon",[function(){return{restrict:"E",templateUrl:"icon/icon.html",scope:{name:"@",iconClick:"&",tooltip:"@",override:"@"},controller:"IconCtrl",controllerAs:"iconCtrl"}}])}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.store=null,this.$scope=b,this.$timeout=c,this.tearingOut=!1,this.watch()}return _createClass(a,[{key:"watch",value:function(){var a=this;this.$scope.$on("tearoutStart",function(){a.$timeout(function(){a.tearingOut=!0})}),this.$scope.$on("tearoutEnd",function(){a.$timeout(function(){a.tearingOut=!1})})}},{key:"disablePointer",value:function(){return this.tearingOut}},{key:"isCompact",value:function(){return!this.store&&window.storeService&&(this.store=window.storeService.open(window.name)),this.store&&this.store.isCompact()}}]),a}();a.$inject=["$scope","$timeout"],angular.module("stockflux.main").controller("MainCtrl",a)}(),function(){angular.module("stockflux.main").directive("main",["$timeout",function(a){return{restrict:"E",templateUrl:"main/main.html",controller:"MainCtrl",controllerAs:"mainCtrl",link:function(b,c){b.$on("compactChanging",function(){c.addClass("disable-transitions"),a(function(){c.removeClass("disable-transitions")},100)})}}}])}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.currentWindowService=b,this.version=c}return _createClass(a,[{key:"openGithub",value:function(){this.currentWindowService.openUrlWithBrowser("https://github.com/ScottLogic/stockflux")}}]),a}();a.$inject=["currentWindowService","Version"],angular.module("stockflux.version").controller("VersionCtrl",a)}(),function(){angular.module("stockflux.version").directive("version",[function(){return{restrict:"E",templateUrl:"main/version/version.html",controller:"VersionCtrl",controllerAs:"versionCtrl"}}])}(),function(a){angular.module("stockflux.currentWindow").factory("currentWindowService",["$rootScope",function(b){function c(){return a.desktop.Window.getCurrent()}function d(b){a.desktop.main(b)}function e(b){d(function(){a.desktop.System.openUrlWithBrowser(b)})}return window.addEventListener("updateFavourites",function(a){b.$broadcast("updateFavourites",a.stock)}),{getCurrentWindow:c,openUrlWithBrowser:e,ready:d}}])}(fin),function(){function a(){return moment().subtract(28,"days")}function b(a,b,c){var d=a.dataset_code,e={name:a.name,code:d,favourite:!1,query:b};c(e)}function c(a){return a&&!a.quandl_error}function d(b){for(var c=b.datasets,d=[],e=0,f=c.length;f>e;e++)moment(c[e].newest_available_date)>a()&&d.push(c[e]);return{datasets:d}}function e(a){var b=a.dataset,c=b.data,d=[],e=0,g=c.length;for(e;g>e;e++)d.push(f(c[e]));a.stockData={success:!0,startDate:b.start_date,endDate:b.end_date,data:d}}function f(a){return{date:a[i],open:a[j],high:a[k],low:a[l],close:a[m],volume:a[n]}}var g="kM9Z9aEULVDD7svZ4A8B",h="api_key="+g,i=0,j=8,k=9,l=10,m=11,n=12,o="https://www.quandl.com/api/v3/",p="datasets/WIKI/",q=function(){function f(a){_classCallCheck(this,f),this.$resource=a}return _createClass(f,[{key:"search",value:function(a,c,d,e){var f=this,g=arguments.length<=4||void 0===arguments[4]?!1:arguments[4];this.stockSearch(g).get({query:a},function(e){e.datasets.map(function(d){b(d,a,c)}),0===e.datasets.length&&d()},function(b){g?e&&e({success:!1,code:b.status,message:b.statusText}):f.search(a,c,d,e,!0)})}},{key:"getMeta",value:function(a,c){this.stockMetadata().get({stock_code:a},function(d){b(d.dataset,a,c)})}},{key:"stockData",value:function(){var b,d=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],f=a().format("YYYY-MM-DD");return this.$resource(o+p+":code.json?"+(d?"":h)+"&start_date="+f,{},{get:{method:"GET",transformResponse:function(a,d){return b=angular.fromJson(a),c(b)&&e(b),b},cache:!0}})}},{key:"getData",value:function(a,b,c){var d=this,e=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];return this.stockData(e).get({code:a},function(c){b({success:!0,code:a,name:c.dataset.name,data:c.stockData.data})},function(f){e?c&&c({success:!1,code:f.status,message:f.statusText}):d.getData(a,b,c,!0)})}},{key:"stockMetadata",value:function(){return this.$resource(o+p+":stock_code/metadata.json?"+h,{},{get:{method:"GET",cache:!0}})}},{key:"stockSearch",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this.$resource(o+"datasets.json?"+(a?"":h)+"&query=:query&database_code=WIKI",{},{get:{method:"GET",cache:!0,transformResponse:function(a,b){var e=angular.fromJson(a);return c(e)?d(e):{}}}})}},{key:"apiKey",value:function(){return g}}]),f}();q.$inject=["$resource"],angular.module("stockflux.quandl",["ngResource"]).service("quandlService",q)}(),function(){var a={code:"",name:""},b=function(){function b(){_classCallCheck(this,b),this._stock=a}return _createClass(b,[{key:"select",value:function(a){this._stock=a}},{key:"selectedStock",value:function(){return this._stock}},{key:"deselect",value:function(){this._stock=a}},{key:"hasSelection",value:function(){return this._stock!==a}}]),b}();b.$inject=[],angular.module("stockflux.selection",[]).service("selectionService",b)}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.selectionService=b}return _createClass(a,[{key:"selectionCode",value:function(){return this.selectionService.selectedStock().code}},{key:"selectionName",value:function(){return this.selectionService.selectedStock().name}},{key:"hasSelection",value:function(){return this.selectionService.hasSelection()}}]),a}();a.$inject=["selectionService"],angular.module("stockflux.showcase",["stockflux.selection","stockflux.quandl"]).controller("ShowcaseCtrl",a)}(),function(a){angular.module("stockflux.showcase").directive("showcase",["quandlService","configService",function(b,c){return{restrict:"E",templateUrl:"showcase/showcase.html",scope:{selection:"&"},link:function(d,e){var f,g=a.app().quandlApiKey(b.apiKey()),h=!0,i=function(){!f&&window.storeService&&(f=window.storeService.open(window.name))};i(),f&&g.indicators(f.indicators()),g.periodsOfDataToFetch(c.getBitfluxStockAmount()),g.proportionOfDataToDisplayByDefault(c.getInitialBitfluxProportion()),d.selection&&d.selection()&&(h=!1,g.run(e[0].children[0]),g.changeQuandlProduct(d.selection())),d.$watch("selection()",function(a,b){""!==a&&(i(),h&&(h=!1,g.run(e[0].children[0])),f&&g.indicators(f.indicators()),a!==b&&g.changeQuandlProduct(a))}),d.$watchCollection(function(){return g.indicators()},function(a){i(),f&&f.indicators(a)})}}}])}(bitflux),function(){var a={up:"arrow_up",down:"arrow_down"},b=function(){function b(a,c,d,e,f){_classCallCheck(this,b),this.currentWindowService=a,this.quandlService=c,this.selectionService=d,this.$scope=e,this.$timeout=f,this.store=null,this.receivedFirstQuandlResponse=!1,this.stocks=[],this.errors=[],this.update(),this._watch()}return _createClass(b,[{key:"icon",value:function(b){return b.delta<0?a.down:a.up}},{key:"selection",value:function(){return this.selectionService.selectedStock().code}},{key:"select",value:function(a){this.selectionService.select(a)}},{key:"singleClick",value:function(a){window.storeService.open(window.name).isCompact()||this.select(a)}},{key:"doubleClick",value:function(a){var b=window.storeService.open(window.name);b.isCompact()&&(this.select(a),b.toggleCompact())}},{key:"noFavourites",value:function(){return 0===this.stocks.length}},{key:"single",value:function(){return 1===this.stocks.length?"single":""}},{key:"update",value:function(a){var b=this;this.currentWindowService.ready(function(){if(window.storeService){b.store||(b.store=window.storeService.open(window.name)),b.favourites=b.store.get(),0===b.favourites.length&&b.$timeout(function(){b.receivedFirstQuandlResponse=!0});var c,d,e;for(c=0,d=b.stocks.length;d>c;c++){var f=b.stocks[c];f.index=b.stockSortFunction(f)}var g=[];for(c=0,d=b.stocks.length;d>c;c++)-1===b.favourites.indexOf(b.stocks[c].code)&&g.push(c);for(c=g.length-1,e=0;c>=e;c--)b.stocks.splice(g[c],1);var h=b.selectionService.selectedStock();if(a)if(0===b.stocks.length)a.favourite?b.selectionService.select(a):h.code===a.code&&b.selectionService.deselect();else if(h.code===a.code&&(!a.favourite||-1===b.favourites.indexOf(h.code))&&b.stocks.length>0){var i=b.stocks.filter(function(a){return a.code===b.favourites[0]})[0];b.selectionService.select(i)}b.errors=[],b.favourites.map(function(a){-1===b.stocks.map(function(a){return a.code}).indexOf(a)&&b.quandlService.getData(a,function(c){if(b.receivedFirstQuandlResponse=!0,-1===b.stocks.map(function(a){return a.code}).indexOf(a)){var d=c&&c.data&&c.data[0],e=d.close-d.open;d&&b.stocks.push({favourite:!0,name:c.name,code:c.code,price:d.close,delta:e,percentage:e/d.open*100,index:b.stockSortFunction(c)})}},function(a){b.receivedFirstQuandlResponse=!0,b._addError({code:a&&a.code||"No code received",message:a&&a.message||"No message"})})})}})}},{key:"_addError",value:function(a){for(var b=this.errors,c=b.length,d=a.code,e=0;c>e;e++)if(b[e]&&b[e].code===d)return void b[e].occurences++;a.occurences=1,this.errors.push(a)}},{key:"stockSortFunction",value:function(a){return this.favourites.indexOf(a.code)}},{key:"_watch",value:function(){var a=this;this.$scope.$on("updateFavourites",function(b,c){a.$timeout(function(){a.update(c)})})}}]),b}();b.$inject=["currentWindowService","quandlService","selectionService","$scope","$timeout"],angular.module("stockflux.favourites").controller("FavouritesCtrl",b)}(),function(){angular.module("stockflux.favourites").directive("favourite",[function(){return{restrict:"E",templateUrl:"sidebars/favourites/favourite.html",scope:{stock:"=",selection:"&",select:"&",singleClick:"&",doubleClick:"&",icon:"&",single:"&"}}}])}(),function(){function a(a){return{height:a.outerHeight,width:a.outerWidth,top:a.screenY,left:a.screenX}}function b(a,b){var c=b.getBoundingClientRect();return{height:c.height,width:c.width,top:a.top+c.top,left:a.left+c.left}}function c(a,b){var c=new e(a),d=new e(b);return c.intersects(d)}var d=function g(a,b){_classCallCheck(this,g),this.x=a||0,this.y=b||0},e=function(){function a(b){_classCallCheck(this,a),this.origin=new d(b.left,b.top),this.extent=new d(b.width,b.height)}return _createClass(a,[{key:"top",value:function(){return this.origin.y}},{key:"left",value:function(){return this.origin.x}},{key:"bottom",value:function(){return this.top()+this.extent.y}},{key:"right",value:function(){return this.left()+this.extent.x}},{key:"corner",value:function(){return new d(this.right(),this.bottom())}},{key:"intersects",value:function(a){var b=a.origin,c=a.corner();return c.x>this.origin.x&&c.y>this.origin.y&&b.x<this.corner().x&&b.y<this.corner().y}}]),a}(),f=function(){function d(){_classCallCheck(this,d)}return _createClass(d,[{key:"elementIntersect",value:function(d,e,f){var g=d.getNativeWindow();return c(a(g),b(a(e),f))}}]),d}();angular.module("stockflux.geometry",[]).service("geometryService",f)}(),function(){var a=function(){function a(b){_classCallCheck(this,a),this.$rootScope=b,this.hoverTargets=[]}return _createClass(a,[{key:"get",value:function(){return this.hoverTargets}},{key:"add",value:function(a,b){var c={hoverArea:a,code:b};-1===this.hoverTargets.indexOf(c)&&this.hoverTargets.push(c)}},{key:"remove",value:function(a){for(var b=0,c=this.hoverTargets.length;c>b;b++)if(this.hoverTargets[b].code===a){this.hoverTargets.splice(b,1);break}}}]),a}();a.$inject=["$rootScope"],angular.module("stockflux.hover",[]).service("hoverService",a)}(),function(){var a=function(){function a(b,c){_classCallCheck(this,a),this.quandlService=b,this.$timeout=c}return _createClass(a,[{key:"renderChart",value:function(a){var b=this;this.$timeout(function(){b.quandlService.getData(a.code,function(a){var b=fc.util.innerDimensions(document.getElementById(a.code+"chart")),c=b.width,d=b.height,e=a.data;if(a.success){e=e.map(function(a){var b=moment(a.date);return a.date=b.toDate(),a});var f=d3.select("#"+a.code+"chart").insert("svg","div").attr("width",c).attr("height",d),g=fc.scale.dateTime().domain(fc.util.extent().fields("date")(e)).discontinuityProvider(fc.scale.discontinuity.skipWeekends()).range([0,c]),h=fc.util.extent().fields(["close"])(e),i=d3.scale.linear().domain(h).range([d,0]).nice(),j=fc.series.area().y0Value(function(a){return h[0]}).y1Value(function(a){return a.close}).decorate(function(b){b.attr("fill","url(#"+a.code+"-minichart-gradient)")}),k=fc.series.line(),l=[].concat(e.slice(0)[0]),m=fc.series.point(),n=fc.series.multi().series([j,k,m]).xScale(g).yScale(i).mapping(function(a){switch(a){case m:return l;default:return e}});f.append("g").datum(e).call(n)}})})}}]),a}();a.$inject=["quandlService","$timeout"],angular.module("stockflux.minichart",["stockflux.quandl"]).controller("MinichartCtrl",a)}(),function(){angular.module("stockflux.minichart").directive("minichart",[function(){return{restrict:"E",templateUrl:"sidebars/favourites/minichart/minichart.html",scope:{renderChart:"&",stock:"="}}}])}(),function(a){var b=".favourites";angular.module("stockflux.tearout").directive("tearable",["geometryService","hoverService","currentWindowService","configService","$rootScope",function(c,d,e,f,g){return{restrict:"C",link:function(h,i,j){function k(a,b){G.x=a,G.y=b}function l(a,b){var c=5,d=5,e=16;C.moveTo(a-A+(e-G.x+d),b-(c+G.y))}function m(){C.show(),C.setAsForeground()}function n(a,b){b.contentWindow.document.body.appendChild(a)}function o(){D.appendChild(z),C.hide()}function p(){var a=C.getNativeWindow().document;a.body=a.createElement("body")}function q(a){return 0!==a.button?!1:y.classList.contains("single")?!1:(g.$broadcast("tearoutStart"),x=B.registerDrag(C,e.getCurrentWindow()),H=!0,k(a.offsetX,a.offsetY),l(a.screenX,a.screenY),p(),n(z,C),void m())}function r(a){H&&l(a.screenX,a.screenY)}function s(c){return 0!==c.button?!1:(g.$broadcast("tearoutEnd"),void(H&&(H=!1,x.overThisInstance(b)?o():(w||(w=a.storeService.open(a.name)),x.overAnotherInstance(b,function(b){if(b)x.moveToOtherInstance(h.stock),x.destroy(),w.remove(h.stock);else{var d=w.isCompact();B.createMainWindow(null,d,function(b,e){b.resizeTo(a.outerWidth,a.outerHeight,"top-left");var g=f.getTopCardOffset(d);b.moveTo(c.screenX-g[0],c.screenY-g[1],e);var i=a.storeService.open(b.name);i.add(h.stock),w.remove(h.stock),i.toggleCompact(d)})}E.removeChild(F),E.removeChild(D),v(),C.close()})))))}function t(){for(var b=d.get(),e=0,f=b.length;f>e;e++){var g=c.elementIntersect(C,a,b[e].hoverArea);if(g){w||(w=a.storeService.open(a.name)),w.reorder(h.stock.code,b[e].code);break}}}function u(){x.overThisInstance(b)?t():x.updateIntersections(b)}function v(){d.remove(h.stock.code),C.removeEventListener("bounds-changing",u),y.removeEventListener("mousedown",q),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)}var w,x,y=i[0],z=y.parentNode.parentNode,A=z.clientWidth||230,B=(z.clientHeight||100,a.windowService),C=B.createTearoutWindow(a.name),D=z.parentNode,E=D.parentNode,F=E.getElementsByClassName("hover-area")[0],G={x:0,y:0},H=!1;d.add(F,h.stock.code),C.addEventListener("bounds-changing",u),y.addEventListener("mousedown",q),document.addEventListener("mousemove",r,!0),document.addEventListener("mouseup",s,!0),h.$on("$destroy",function(){v()})}}}])}(window),function(){angular.module("stockflux.filters").filter("truncate",function(){return function(a){if(a){var b=a.indexOf("(");return a.slice(0,b-1)}}})}(),function(){angular.module("stockflux.scroll").directive("customScrollbar",[function(){return{restrict:"C",link:function(a,b){var c="scroll-padding";a.$on("disableScrolling",function(){b.mCustomScrollbar("disable")}),a.$on("enableScrolling",function(){b.mCustomScrollbar("update")}),b.mCustomScrollbar({scrollInertia:0,mouseWheel:{scrollAmount:80},callbacks:{onOverflowY:function(){b.addClass(c)},onOverflowYNone:function(){b.removeClass(c)}}})}}}])}(),function(){var a=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.$scope=b,this.$timeout=c,this.quandlService=d,this.selectionService=e,this.currentWindowService=f,this.store=null,this.query="",this.noResults=!1,this.stocks=[],this.errors=[],this.isLoading=!1,this._watch()}return _createClass(a,[{key:"selection",value:function(){return this.selectionService.selectedStock().code}},{key:"select",value:function(a){this.store||(this.store=window.storeService.open(window.name)),this.store.isCompact()||this.selectionService.select(a)}},{key:"onSearchKeyDown",value:function(a){38===a.keyCode?this.changePointer(-1):40===a.keyCode?this.changePointer(1):13===a.keyCode?this.changePointer(0):27===a.keyCode&&this.$scope.sidebarCtrl.favouritesClick()}},{key:"changePointer",value:function(a){var b=this.stocks.map(function(a){return a.code}).indexOf(this.selection()),c=b+a;c=Math.max(0,Math.min(c,this.stocks.length-1)),this.stocks.length>0&&this.select(this.stocks[c])}},{key:"submit",value:function(){var a=this;this.stocks=[],this.noResults=!1,this.currentWindowService.ready(function(){a.store||(a.store=window.storeService.open(window.name));var b=a.store.get();if(a.query){var c=b.length;a.isLoading=!0,a.errors=[],a.quandlService.search(a.query,function(d){a.isLoading=!1;var e;if(a.stocks=a.stocks.filter(function(b,c){return b.query===a.query}),d.query===a.query){a.noResults=!1;var f=!1;for(e=0;c>e;e++)d.code===b[e]&&(d.favourite=!0,a.stocks.unshift(d),f=!0);f||a.stocks.push(d)}},function(){a.noResults=!0},function(b){a.isLoading=!1,a._addError({code:b&&b.code||"No code received",message:b&&b.message||"No message"})})}else b.map(function(b){a.quandlService.getMeta(b,function(b){b.favourite=!0,a.stocks.push(b)})})})}},{key:"_addError",value:function(a){for(var b=this.errors,c=b.length,d=a.code,e=0;c>e;e++)if(b[e]&&b[e].code===d)return void b[e].occurences++;a.occurences=1,this.errors.push(a)}},{key:"_watch",value:function(){var a=this;this.$scope.$watch(function(){return a.query},function(){a.submit()}),this.$scope.$on("updateFavourites",function(b,c){a.$timeout(function(){if(c){var b=a.stocks.map(function(a){return a.code}).indexOf(c.code);b>-1?a.query?a.stocks[b].favourite=c.favourite:a.stocks.splice(b,1):c.favourite&&a.stocks.push(c)}})})}},{key:"darkenClass",value:function(a){return this.selection()===a.code||a.isHovered?"dark":""}}]),a}();a.$inject=["$scope","$timeout","quandlService","selectionService","currentWindowService"],angular.module("stockflux.search").controller("SearchCtrl",a)}(),function(){angular.module("stockflux.search").directive("search",["$timeout",function(a){return{restrict:"E",templateUrl:"sidebars/search/search.html",controller:"SearchCtrl",controllerAs:"searchCtrl",link:function(b,c){c.on("click",function(){a(function(){c.find("input.sidetab").focus()},100)})}}}])}(),function(){var a={expanded:"expanded",contracted:"contracted"},b=function(){function b(){_classCallCheck(this,b),this._favouritesClass=a.expanded,this._searchClass=a.contracted,this._showSearches=!1,this._showFavourites=!0,this._searchSmall=!0}return _createClass(b,[{key:"searchClass",value:function(){return this._searchClass}},{key:"favouritesClass",value:function(){return this._favouritesClass}},{key:"showSearches",value:function(){return this._showSearches}},{key:"showFavourites",value:function(){return this._showFavourites}},{key:"searchClick",value:function(){this._searchSmall&&(this._searchSmall=!1,this._showFavourites=!1,this._searchClass=a.expanded,this._favouritesClass=a.contracted,this._showSearches=!0)}},{key:"favouritesClick",value:function(){this._searchSmall||(this._searchSmall=!0,this._searchClass=a.contracted,this._favouritesClass=a.expanded,this._showSearches=!1,this._showFavourites=!0)}}]),b}();b.$inject=[],angular.module("stockflux.sidebar").controller("SidebarCtrl",b)}(),function(){angular.module("stockflux.sidebar").directive("sideBar",["$timeout",function(a){return{restrict:"E",templateUrl:"sidebars/sidebar.html",controller:"SidebarCtrl",controllerAs:"sidebarCtrl",link:function(b,c){window.addEventListener("dragout",function(){a(function(){b.sidebarCtrl.isTearoutTarget=!1})}),window.addEventListener("dragin",function(){a(function(){b.sidebarCtrl.isTearoutTarget=!0})})}}}])}(),function(){var a={off:"favourite_off",on:"favourite_on",offHover:"favourite_off_hover",onHover:"favourite_hover"},b=function(){function b(a,c){_classCallCheck(this,b),this.$scope=a,this.store=null,this.selectionService=c,this.starHovered=!1,this.stock=a.stock,this.check=a.confirm,this.confirmationShow=!1,this.mouseY=0,this.viewHeight=720}return _createClass(b,[{key:"favouriteUrl",value:function(){return this.stock.favourite?a.on:this.starHovered?a.onHover:this.stock.isHovered||this.selectionService.selectedStock()===this.stock?a.offHover:a.off}},{key:"tooltip",value:function(){return this.stock.favourite?"Unfavourite Stock":"Favourite Stock"}},{key:"modalFlip",value:function(){var a=84,b=this.mouseY+25;return this.viewHeight<b+a}},{key:"modalTop",value:function c(){var c=this.mouseY+25;return this.modalFlip()&&(c=this.mouseY-95),c}},{key:"modalBubbleTop",value:function(){var a=this.modalTop()-5;return this.modalFlip()&&(a=this.modalTop()+79),a}},{key:"click",value:function(a){this.mouseY=a.currentTarget.y,this.viewHeight=a.view.innerHeight,this.check?(this.confirmationShow=!0,this.$scope.$emit("disableScrolling")):(this.store||(this.store=window.storeService.open(window.name)),this.stock.favourite?this.deselect():(this.stock.favourite=!0,this.store.add(this.stock)))}},{key:"deselect",value:function(){this.store||(this.store=window.storeService.open(window.name)),this.stock.favourite=!1,this.store.remove(this.stock),this.hideModal()}},{key:"hideModal",value:function(){this.confirmationShow=!1,this.$scope.$emit("enableScrolling")}},{key:"mouseEnter",value:function(){this.starHovered=!0}},{key:"mouseLeave",value:function(){this.starHovered=!1}}]),b}();b.$inject=["$scope","selectionService"],angular.module("stockflux.star").controller("StarCtrl",b)}(),function(){angular.module("stockflux.star").directive("star",[function(){return{restrict:"E",templateUrl:"sidebars/star/star.html",scope:{stock:"=",confirm:"="},controller:"StarCtrl",controllerAs:"starCtrl"}}])}(),function(){var a,b="windows",c="version",d=["AAPL","MSFT","TITN","SNDK","TSLA"],e=["rsi","movingAverage"],f=5,g=function(){function c(a,b,d){_classCallCheck(this,c),this.$rootScope=a,this.store=b,this.windowName=d}return _createClass(c,[{key:"save",value:function(){localStorage.setItem(b,angular.toJson(a))}},{key:"update",value:function(a){this.save(),this.$rootScope.$broadcast("updateFavourites",a,this.windowName)}},{key:"get",value:function(){return this.store.stocks}},{key:"indicators",value:function(a){return arguments.length?(this.store.indicators=a,void this.save()):this.store.indicators}},{key:"reorder",value:function(a,b){if(a!==b){var c=this.store.stocks,d=c.indexOf(a),e=c.indexOf(b);c.splice(e,0,c.splice(d,1)[0]),this.update()}}},{key:"add",value:function(a){var b=a.code;-1===this.store.stocks.indexOf(b)&&(this.store.stocks.push(b),this.update(a))}},{key:"remove",value:function(a){var b=a.code,c=this.store.stocks.indexOf(b);c>-1&&this.store.stocks.splice(c,1),this.update(a)}},{key:"toggleCompact",value:function(a){this.store.compact=arguments.length?a:!this.store.compact,this.save()}},{key:"isCompact",value:function(){return this.store.compact}},{key:"openWindow",value:function(){this.store.closed=0,this.save(),this.$rootScope.$broadcast("openWindow")}},{key:"closeWindow",value:function(){this.store.closed=Date.now(),this.save(),this.$rootScope.$broadcast("closeWindow");var b=a.filter(function(a){return 0!==a.closed});if(b.length>f){b.sort(function(a,b){return b.closed-a.closed});for(var c=f,d=b.length;d>c;c++){var e=a.indexOf(b[c]);a.splice(e,1)}}this.save()}}]),c}(),h=function(){function f(c,d){_classCallCheck(this,f),this.$rootScope=c,this.version=d,a=JSON.parse(localStorage.getItem(b))}return _createClass(f,[{key:"shouldUpgrade",value:function(){if(null==localStorage.getItem(c))return!0;var a=function(a){return a.split(".").map(function(a){return Number(a)})},b=a(this.version),d=a(localStorage.getItem(c));return b[0]!==d[0]}},{key:"upgrade",value:function(){localStorage.removeItem(b),a=null}},{key:"saveVersion",value:function(){localStorage.setItem(c,this.version)}},{key:"getPreviousOpenWindowNames",value:function(){return(a||[]).filter(function(a){return 0===a.closed}).map(function(a){return a.id})}},{key:"getPreviousClosedWindows",value:function(){return(a||[]).filter(function(a){return a.closed>0})}},{key:"open",value:function(b){var c,f=(a||[]).map(function(a){return a.id}).indexOf(b);if(f>-1)c=a[f];else{var h=[],i=e.slice();a||(h=d,a=[]);var j={id:b,stocks:h,indicators:i,closed:0,compact:!1};a.push(j),c=j}return new g(this.$rootScope,c,b)}}]),f}();h.$inject=["$rootScope","Version"],angular.module("stockflux.store").service("storeService",h)}(),function(){var a=1280,b=720,c=230,d=500,e=function(){function e(a,b,c){var d=this;_classCallCheck(this,e),this.$scope=a,this.$timeout=b,this.currentWindowService=c,this.store=null,this.window=null,this.maximised=!1,this.oldSize=null,this.maximisedEvent=function(){d.$timeout(function(){d.maximised=!0})},this.restoredEvent=function(){d.$timeout(function(){d.maximised=!1})},c.ready(function(){var a=d.onReady.bind(d);a(),d._watch()})}return _createClass(e,[{key:"isCompact",value:function(){return!this.store&&window.storeService&&(this.store=window.storeService.open(window.name)),this.store&&this.store.isCompact()}},{key:"onReady",value:function(){this.window=this.currentWindowService.getCurrentWindow(),this.window.addEventListener("maximized",this.maximisedEvent),this.window.addEventListener("restored",this.restoredEvent)}},{key:"minimiseClick",value:function(){this.window.minimize()}},{key:"maximiseClick",value:function(){
this.window.maximize()}},{key:"normalSizeClick",value:function(){this.window.restore(),this.window.resizeTo(a,b,"top-right")}},{key:"_compactChanged",value:function(){var e=this.isCompact();if(window.outerWidth!==c&&(this.oldSize=[window.outerWidth,window.outerHeight]),window.windowService&&window.windowService.updateOptions(this.window,e),e)this.window.resizeTo(c,d,"top-right");else if(this.maximised)this.window.maximize();else{var f=a,g=b;this.oldSize&&(f=this.oldSize[0],g=this.oldSize[1]),this.window.resizeTo(f,g,"top-right")}this.$scope.$broadcast("compactChanging")}},{key:"compactClick",value:function(){this.store||(this.store=window.storeService.open(window.name)),this.store.toggleCompact()}},{key:"closeClick",value:function(){this.window.removeEventListener("maximized",this.maximisedEvent),this.window.removeEventListener("restored",this.restoredEvent),this.window.close()}},{key:"_watch",value:function(){var a=this;this.$scope.$watch(function(){return a.isCompact()},function(){return a._compactChanged()})}}]),e}();e.$inject=["$scope","$timeout","currentWindowService"],angular.module("stockflux.toolbar").controller("ToolbarCtrl",e)}(),function(){angular.module("stockflux.toolbar").directive("toolbar",[function(){return{restrict:"E",templateUrl:"toolbar/toolbar.html",controller:"ToolbarCtrl",controllerAs:"toolbarCtrl"}}])}(),function(){var a={version:"10.0.1"};angular.module("stockflux.version").value("Version",a.version)}();